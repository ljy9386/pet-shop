  try {
    console.log("🔑 소셜 로그인 시도:", userData);
    const res = await fetch("https://miraclepet.kr/api/auth/social-login", {
      method: "POST",
      headers: { 
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      credentials: 'include', // 쿠키 포함
      body: JSON.stringify({ user_id: userData.user_id })
    });

    console.log("📥 서버 응답 상태:", res.status);
    const data = await res.json();
    console.log("📥 서버 응답 데이터:", data);

    if (!res.ok) {
      console.error("❌ 로그인 실패:", data.message);
      errorMessage.textContent = data.message || "로그인 실패";
      return;
    }

    console.log("✅ 로그인 성공:", data);

    // ✅ 로그인 유지
    const userToStore = {
      ...data.user,
      isLoggedIn: true,
      sessionId: data.sessionId
    };
    console.log("💾 저장할 사용자 정보:", userToStore);
    
    // localStorage에 저장
    localStorage.setItem("user", JSON.stringify(userToStore));
    
    // sessionStorage에도 저장
    sessionStorage.setItem("user", JSON.stringify(userToStore));
    
    // 로그 확인을 위한 지연
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    console.log("🔄 페이지 이동 전 최종 상태:", {
      localStorage: localStorage.getItem("user"),
      sessionStorage: sessionStorage.getItem("user"),
      cookies: document.cookie
    });
    
    alert("로그인 완료!");
    
    // 페이지 이동
    window.location.replace("index.html");
  } catch (err) {
    console.error("❌ 로그인 에러 발생:", err);
    console.error("에러 상세:", {
      message: err.message,
      stack: err.stack,
      name: err.name
    });
    errorMessage.textContent = "서버 오류가 발생했습니다.";
  } 